<app-form></app-form>
<app-toast></app-toast>
<main
  class="main"
  *ngIf="{
    projects: projects$ | async,
    projectsError: projectsError$ | async
  } as vm">
  <app-navigation
    [showTasksButton]="!!vm.projects && !vm.projectsError"></app-navigation>
  <ul class="projects">
    <div class="button-container">
      <app-open-form-button
        *ngIf="vm.projects && !vm.projectsError"
        type="project"
        text="Add project"></app-open-form-button>
      <div class="mobile-buttons">
        <app-open-form-button
          *ngIf="vm.projects && !vm.projectsError"
          text="Tasks"
          type="see-tasks"></app-open-form-button>
        <app-open-form-button
          text="Profile"
          type="profile"></app-open-form-button>
      </div>
    </div>
    <app-loading-spinner
      [condition]="!vm.projectsError && !vm.projects"></app-loading-spinner>
    <div class="error-message" *ngIf="vm.projectsError as error">
      <h2>{{ error }}</h2>
    </div>
    <li
      *ngFor="let project of vm.projects; trackBy: projectTrackBy"
      class="table">
      <div class="project-name-wrapper">
        <div class="project-name-container">
          <h2>{{ project.name }}</h2>
          <app-open-form-button
            *ngIf="project.userId === (loggedInUserId$ | async)"
            type="board"
            text="Add board"
            size="compact"
            [parentId]="project.id"></app-open-form-button>
        </div>
      </div>
      <div class="row-header row">
        <span
          *ngFor="let column of columns; let i = index"
          [class]="'column-header column-' + i"
          >{{ column }}</span
        >
      </div>
      <div *ngIf="project.boards.length === 0" class="message-wrapper">
        <p>No boards to display</p>
      </div>
      <div *ngFor="let board of project.boards; trackBy: boardTrackBy">
        <a
          [routerLink]="['/', 'project', project.id, 'board', board.id]"
          type="button"
          class="accordion-item row">
          <span class="column column-0">{{ board.name }}</span>
          <span class="column column-1">{{ (board | getColumns).length }}</span>
          <span class="column column-2">{{ (board | getTasks).length }}</span>
          <span class="column column-3">{{
            (board | getSubtasks).length
          }}</span>
        </a>
      </div>
    </li>
  </ul>
</main>
